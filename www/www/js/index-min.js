var KM={RED:"#FF0000",YELLOW:"#FFFF00",GREEN:"#00FF00",BLUE:"#0000FF",BLACK:"#000000",WHITE:"#FFFFFF",GREY:"#C1C1C1",DARK_GREY:"#818181",GHOST:"#E2E2E2",BUTTON_BLINK:"BUTTON_BLINK",GET_DATA:"GET_DATA",DISPLAY_LOOP:"DISPLAY_LOOP",ARCH_LOOP:"ARCH_LOOP",LOGS:"LOGS_LOOP",CONFIG_LOOP:"CONFIG_LOOP",MISC_JUMP:"MISC_JUMP",browser:{browser_FF:!1,browser_IE:!1,browser_OP:!1,browser_SP:!1},session_id:{current:0},config:{},menu_bar_buttons:{function_selected:0,display_sec_enabled:!1,camera_sec_enabled:!1},max_feed:function(e){var t=0;if(e)for(var n in KM.config.feeds)KM.config.feeds[n].feed_enabled&&t++;else t=Object.keys(KM.config.feeds).length;return t},show_loading:function(e){e.classList.add("loading_image")},hide_loading:function(e){e.classList.remove("loading_image")},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},toggle_button_bar:function(){var e=document.getElementById("button_bar"),t=document.getElementById("toggle_button_bar");"none"==e.style.display?(e.style.display="block",t.style.right="175px",document.getElementById("main_display").style.right="185px"):(e.style.display="none",t.style.right="0px",document.getElementById("main_display").style.right="10px")}};KM.browser.set_title=function(){document.getElementById("version_num").innerHTML="Ver "+KM.config.version,document.getElementsByTagName("title")[0].innerHTML=KM.config.title},KM.timeout_ids=function(){var e={};return{add_id:function(t,n){void 0===e[t]&&(e[t]=[]),e[t].push(n)},cull_ids:function(t){if(void 0!==e[t]&&e[t].length>1){for(var n=0;n<e[t].length-1;n++)clearTimeout(e[t][n]),delete e[t][n];e[t].length=1}},kill_ids:function(t){if(void 0!==e[t]&&e[t].length>0){for(var n=0;n<e[t].length;n++)clearTimeout(e[t][n]),delete e[t][n];delete e[t]}}}}(),KM.add_timeout_id=KM.timeout_ids.add_id,KM.cull_timeout_ids=KM.timeout_ids.cull_ids,KM.kill_timeout_ids=KM.timeout_ids.kill_ids,KM.get_xmlHttp_obj=function(){var e=null;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){e=new ActiveXObject("Microsoft.XMLHTTP")}}return e},KM.json_request=function(e,t,n,i){var o=KM.get_xmlHttp_obj(),a=t;t=JSON.stringify(a);o.open("POST",e,!0),o.setRequestHeader("Content-type","application/json"),o.onreadystatechange=function(){if(4==o.readyState&&(o.onreadystatechange=null,200==o.status))try{var e=JSON.parse(o.responseText);if(e.id!=a.id){if(console.log("Invalid ID"),i)try{i()}catch(e){console.log(e)}return!1}if(e.error){if(console.log(e.error.message),i)try{i()}catch(e){console.log(e)}return!1}if(n)try{n(e.result)}catch(e){return console.log(e),!1}return!0}catch(e){if(console.log(e),i)try{i()}catch(e){console.log(e)}return!1}},o.send(t)},KM.secs_hhmmss=function(e){var t=parseInt(e/3600,10),n=parseInt((e-60*t*60)/60,10),i=parseInt(e-60*t*60-60*n,10);return KM.pad_out2(t)+KM.pad_out2(n)+KM.pad_out2(i)},KM.secs_hh_mm_ss=function(e){var t=parseInt(e/3600,10),n=parseInt((e-60*t*60)/60,10),i=parseInt(e-60*t*60-60*n,10);return KM.pad_out2(t)+":"+KM.pad_out2(n)+":"+KM.pad_out2(i)},KM.hhmmss_secs=function(e){return e=KM.pad_out6(e),60*parseInt(e.slice(0,2),10)*60+60*parseInt(e.slice(2,4),10)+parseInt(e.slice(4,6),10)},KM.expand_chars=function(e){return e=(e=(e=e.replace(/&/g,"<amp>")).replace(/\?/g,"<que>")).replace(/:/g,"<col>")},KM.collapse_chars=function(e){return e=(e=(e=e.replace(/<amp>/g,"&")).replace(/<que>/g,"?")).replace(/<col>/g,":")},KM.item_in_array=function(e,t){for(var n=e.toString(),i=0;i<t.length;i++)if(t[i].toString()==n)return!0;return!1},KM.pad_out=function(e,t){return String(e).length<t&&(e="00000000000000000000".substr(0,t-String(e).length)+String(e)),String(e)},KM.pad_out2=function(e){return KM.pad_out(e,2)},KM.pad_out4=function(e){return KM.pad_out(e,4)},KM.pad_out6=function(e){return KM.pad_out(e,6)},KM.blink_button=function(e,t){var n=e.style.fontWeight,i=KM.BLUE;e.style.fontWeight="bold",e.style.color=KM.RED,restore_button=function(){KM.kill_timeout_ids(KM.BUTTON_BLINK),e.style.fontWeight=n,e.style.color=i,void 0!==t&&t()},KM.add_timeout_id(KM.BUTTON_BLINK,setTimeout((function(){restore_button()}),250))},KM.enable_display_buttons=function(e){for(var t=1;t<13;t++)t==KM.default_display_select?document.getElementById("d"+t).src="images/z"+t+".png":document.getElementById("d"+t).src=t==e?"images/r"+t+".png":"images/b"+t+".png";KM.menu_bar_buttons.display_sec_enabled=!0},KM.update_display_buttons=KM.enable_display_buttons,KM.disable_display_buttons=function(){for(var e=1;e<13;e++)document.getElementById("d"+e).src="images/g"+e+".png";KM.menu_bar_buttons.display_sec_enabled=!1},KM.menu_bar_buttons.construct_camera_sec=function(){var e="",t=0;for(var n in KM.config.feeds)KM.config.feeds[n].feed_enabled&&(e+=++t%4==0?'<div id="cb'+n+'" class="camera_button" onClick="KM.camera_func_button_clicked('+n+');"><span id="ct'+n+'">'+n+"</span></div>\n</div>":t%4==1?'<div class="button_line">\n<div id="cb'+n+'" class="camera_button" onClick="KM.camera_func_button_clicked('+n+');"><span id="ct'+n+'">'+n+"</span></div>":'<div id="cb'+n+'" class="camera_button" onClick="KM.camera_func_button_clicked('+n+');"><span id="ct'+n+'">'+n+"</span></div>\n");--t%4!=0&&(e+="</div>"),document.getElementById("camera_sec").innerHTML=e},KM.enable_camera_buttons=function(){for(var e in document.getElementById("camera_func_header").innerHTML="Camera Select",KM.config.feeds)if(KM.config.feeds[e].feed_enabled)try{document.getElementById("ct"+e).innerHTML=e,KM.config.feeds[e]&&KM.config.feeds[e].feed_enabled?document.getElementById("ct"+e).style.color=KM.BLUE:document.getElementById("ct"+e).style.color=KM.GREY}catch(e){}KM.menu_bar_buttons.camera_sec_enabled=!0},KM.update_camera_buttons=KM.enable_camera_buttons,KM.disable_camera_buttons=function(){for(var e in document.getElementById("camera_func_header").innerHTML="Camera Select",KM.config.feeds)try{document.getElementById("cb"+e).style.background="url(images/temp1.png) no-repeat bottom left",document.getElementById("ct"+e).innerHTML=e,document.getElementById("ct"+e).style.color=KM.GREY}catch(e){}KM.menu_bar_buttons.camera_sec_enabled=!1},KM.enable_func_buttons=function(){for(var e in document.getElementById("camera_func_header").innerHTML="Function Select",KM.config.feeds)try{document.getElementById("ct"+e).innerHTML="f"+e,document.getElementById("cb"+e).style.background="url(images/temp3.png) no-repeat bottom left",KM.config.func_enabled[e]?document.getElementById("ct"+e).style.color=KM.BLUE:document.getElementById("ct"+e).style.color=KM.GREY}catch(e){}KM.menu_bar_buttons.camera_sec_enabled=!1},KM.update_func_buttons=KM.enable_func_buttons,KM.disable_func_buttons=KM.disable_camera_buttons,KM.blink_camera_func_button=function(e){KM.menu_bar_buttons.camera_sec_enabled&&KM.blink_button(document.getElementById("ct"+e))},KM.enable_function_buttons=function(e){for(var t=["pad","pad","archive_enabled","logs_enabled","config_enabled"],n="none",i=1;i<t.length;i++)KM.config.misc[t[i]]||1==i?i==e?(document.getElementById("ft"+i).style.color=KM.RED,document.getElementById("ft"+i).parentNode.style.display="block",n="block"):(document.getElementById("ft"+i).style.color=KM.BLUE,document.getElementById("ft"+i).parentNode.style.display="block",n="block"):(document.getElementById("ft"+i).style.color=KM.GREY,document.getElementById("ft"+i).parentNode.style.display="none");document.getElementById("misc_function_display").style.display=n},KM.update_function_buttons=KM.enable_function_buttons,KM.display_button_clicked=function(e){KM.menu_bar_buttons.display_sec_enabled&&(KM.update_display_buttons(e),KM.config.misc.display_select=e,KM.display_live.set_last_camera(0),KM.display_live())},KM.camera_func_button_clicked=function(e){KM.menu_bar_buttons.camera_sec_enabled&&KM.config.feeds[e]&&KM.config.feeds[e].feed_enabled&&(KM.blink_camera_func_button(e),KM.config.misc.config_enabled?KM.menu_bar_buttons.camera_sec_enabled&&(KM.display_live.set_last_camera(e),KM.config.display_feeds[1][0]=e,1==KM.config.misc.display_select&&(KM.display_live.set_last_camera(0),KM.display_live())):KM.display_live.camera_jpeg_clicked(e))},KM.function_button_clicked=function(e){if(KM.function_button_valid(e))switch(KM.update_function_buttons(e),KM.menu_bar_buttons.function_selected=e,document.onkeydown=function(e){},e){case 1:KM.enable_display_buttons(KM.config.misc.display_select),KM.enable_camera_buttons(),KM.display_live();break;case 2:KM.disable_display_buttons(),KM.disable_camera_buttons(),KM.display_archive();break;case 3:KM.disable_display_buttons(),KM.disable_camera_buttons(),KM.display_logs();break;case 4:KM.disable_display_buttons(),KM.disable_camera_buttons(),KM.display_config()}},KM.function_button_valid=function(e){return e<2||KM.config.misc[["pad","pad","archive_enabled","logs_enabled","config_enabled"][e]]},KM.background_button_clicked=function(e){var t="css/dark.css";if(1===e)t="css/light.css";var n="themecss";document.getElementById(n)&&(elem=document.getElementById(n)).parentNode.removeChild(elem);var i=document.getElementsByTagName("head")[0],o=document.createElement("link");o.id=n,o.rel="stylesheet",o.type="text/css",o.href=t,o.media="all",i.appendChild(o),KM.config.misc.color_select=e},KM.get_jpeg=function(e){return"/kmotion_ramdisk/"+KM.pad_out2(e)+"/last.jpg?"+Math.random()},KM.load_settings=function(){function e(){KM.show_loading(document.getElementById("main_display"));var t={jsonrpc:"2.0",method:"config",id:Math.random(),params:{read:"1"}};KM.json_request("/ajax/config",t,(function(e){var t;KM.config=e,t=navigator.userAgent.toLowerCase(),KM.browser.browser_IE=t.search("msie")>-1,KM.browser.browser_FF=t.search("firefox")>-1,KM.browser.browser_OP=t.search("opera")>-1,KM.browser.browser_SP=t.search("iphone")>-1||t.search("ipod")>-1||t.search("android")>-1||t.search("ipad")>-1||t.search("iemobile")>-1||t.search("blackberry")>-1,KM.hide_loading(document.getElementById("main_display")),KM.browser.set_title(),KM.background_button_clicked(KM.config.misc.color_select),KM.default_display_select=KM.config.misc.display_select,KM.enable_display_buttons(KM.config.misc.display_select),KM.menu_bar_buttons.construct_camera_sec(),KM.enable_camera_buttons(),KM.config.misc.hide_button_bar&&KM.toggle_button_bar(),KM.enable_function_buttons(1),KM.function_button_clicked(1)}),onerror=function(){KM.kill_timeout_ids(KM.GET_DATA),KM.add_timeout_id(KM.GET_DATA,setTimeout((function(){e()}),5e3))})}return e(),{init:e}}(),KM.init=KM.load_settings.init,KM.display_live_=function(){var e,t=0,n=[],i={},o=0;function a(){KM.session_id.current++,KM.hide_loading(document.getElementById("main_display")),function(e){var t=0,n=0,i="",o=0;function a(){i="",o=0}function l(){document.getElementById("main_display").innerHTML=i}function c(e,t,n,a,l,c,d,s){var r="images/gcam.png";!0===c&&(r="images/gcam_alt.png"),void 0===d&&(d=1),void 0===s&&(s=1);var _=r,m="No Video",u=KM.WHITE;try{var f=KM.config.display_feeds[e][o++];if(!f)return;KM.config.feeds[f].feed_enabled&&(_=KM.get_jpeg(f),u=KM.BLUE,KM.config.feeds[f].feed_name?m=KM.config.feeds[f].feed_name:(m="",KM.config.feeds[f].feed_name=m))}catch(e){}m=f+": "+m;var g=[];g.push('<img id="image_'+f+'" '),g.push('style="left:'+t+"%; "),g.push("top:"+n+"%; "),g.push("width:"+a+"%; "),g.push("height:"+l+'%;" '),g.push('src="'+_+'"; '),g.push('alt="">'),g.push('<span id="text_'+f+'"'),g.push('style="left:'+(t+d)+"%; "),g.push("top:"+(n+s)+"%;"),g.push("width:"+(a-d)+"%; "),g.push("color:"+u+";"),g.push('">'+m+"</span>"),i+=g.join(" ")}function d(e){var i,o,a,l,d,s,r,_,m,u;switch(m=100,u=100,e){case 1:for(r=m/(l=1),_=u/(a=1),i=0;i<a;i++)for(o=0;o<l;o++)c(e,t+o*r,n+i*_,r,_);break;case 2:for(r=m/(l=2),_=u/(a=2),i=0;i<a;i++)for(o=0;o<l;o++)c(e,t+o*r,n+i*_,r,_);break;case 3:for(r=m/(l=3),_=u/(a=3),i=0;i<a;i++)for(o=0;o<l;o++)c(e,t+o*r,n+i*_,r,_);break;case 4:for(r=m/(l=Math.ceil(Math.sqrt(KM.max_feed(!0)))),_=u/(a=Math.ceil(KM.max_feed(!0)/l)),i=0;i<a;i++)for(o=0;o<l;o++)c(e,t+o*r,n+i*_,r,_);break;case 5:a=[0,1,2,2,2],l=[2,2,0,1,2],c(e,t,n,2*(r=m/3),2*(_=u/3));for(var f=0;f<5;f++)i=a[f],o=l[f],c(e,t+o*r,n+i*_,r,_);break;case 6:for(a=[0,0,1,1,2,2,2,2,3,3,3,3],l=[2,3,2,3,0,1,2,3,0,1,2,3],c(e,t,n,2*(r=m/4),2*(_=u/4)),f=0;f<12;f++)i=a[f],o=l[f],c(e,t+o*r,n+i*_,r,_);break;case 7:for(a=[0,1,2,3,3,3,3],l=[3,3,3,0,1,2,3],c(e,t,n,3*(r=m/4),3*(_=u/4)),f=0;f<7;f++)i=a[f],o=l[f],c(e,t+o*r,n+i*_,r,_);break;case 8:for(a=[0,0,1,1,2,2,3,3],l=[2,3,2,3,0,1,0,1],c(e,t,n,2*(r=m/4),2*(_=u/4)),f=0;f<8;f++)i=a[f],o=l[f],c(e,t+o*r,n+i*_,r,_);c(e,t+2*r,n+2*_,2*r-t,2*_-n);break;case 9:s=.28*(_=u),c(e,t,n,r=m,_,!1,.02*r+(d=.28*r)+1,.02*_+1),c(e,t+.02*r,n+.02*_,d,s,!0);break;case 10:d=.28*(r=m),s=.28*(_=u),c(e,t,n,r,_,!1,.02*r,.02*_),c(e,t+r-d-.02*r,n+.02*_,d,s,!0);break;case 11:d=.28*(r=m),s=.28*(_=u),c(e,t,n,r,_,!1,.02*r,.02*_),c(e,t+.02*r,n+_-s-.02*_,d,s,!0);break;case 12:d=.28*(r=m),s=.28*(_=u),c(e,t,n,r,_,!1,.02*r,.02*_),c(e,t+r-d-.02*r,n+_-s-.02*_,d,s,!0)}}a(),d(e),l()}(KM.config.misc.display_select);for(var e,t=!0,n=0;n<KM.config.display_feeds[KM.config.misc.display_select].length;n++)try{e=KM.config.display_feeds[KM.config.misc.display_select][n],KM.config.feeds[e].feed_enabled&&(t=!1)}catch(e){}t||l(KM.session_id.current)}function l(e){KM.kill_timeout_ids(KM.DISPLAY_LOOP),KM.session_id.current===e&&(d(e),KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout((function(){l(e)}),1e3)))}function c(e){var n=KM.config.display_feeds[KM.config.misc.display_select].indexOf(e);if(0!==t&&KM.config.misc.config_enabled){var i=KM.config.display_feeds[KM.config.misc.display_select].indexOf(t),o=KM.config.display_feeds[KM.config.misc.display_select][n];KM.config.feeds[t]&&KM.config.feeds[t].feed_enabled&&(KM.config.display_feeds[KM.config.misc.display_select][n]=t,i>=0&&(KM.config.display_feeds[KM.config.misc.display_select][i]=o)),t=0}else KM.config.misc.config_enabled?KM.config.display_feeds[1][0]=KM.config.display_feeds[KM.config.misc.display_select][n]:KM.config.display_feeds[1][0]=e,KM.config.misc.display_select=1,KM.update_display_buttons(1);a()}function d(e){if(KM.session_id.current===e){var t={jsonrpc:"2.0",method:"feeds",id:Math.random()};KM.json_request("/ajax/feeds",t,(function(e){n=e,function(){for(var e,t,i=0;i<KM.config.display_feeds[KM.config.misc.display_select].length;i++)try{t=KM.config.display_feeds[KM.config.misc.display_select][i],e=KM.WHITE,KM.config.feeds[t].feed_enabled&&(e=KM.BLUE,KM.BLACK,KM.item_in_array(t,n)&&(e=KM.RED,KM.RED)),document.getElementById("text_"+t).style.color=e}catch(e){}}(),function(){var e=KM.config.display_feeds[KM.config.misc.display_select].slice(0);e.sort(s).sort(r),o=0;for(var t=0;t<e.length;t++)_(e[t],e.length)}()}),onerror=function(){KM.kill_timeout_ids(KM.DISPLAY_LOOP),KM.session_id.current===e&&KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout((function(){d()}),100))})}}function s(e,t){return i[t]-i[e]}function r(e,t){var i=KM.item_in_array(e,n),o=KM.item_in_array(t,n);return i&&o?0:i?-1:1}function _(e,t){var a,l=KM.config.feeds[e].feed_fps,d=KM.DISPLAY_LOOP+e;KM.kill_timeout_ids(d);try{if(null===(a=document.getElementById("image_"+e)))return!1;null===a.onclick&&(a.onclick=function(e){return function(){c(e)}}(e)),KM.config.feeds[e].feed_enabled&&(null===a.onload&&(a.onload=function(e){return function(){image_loads.onload(e)}}(e)),null===a.onerror&&(a.onerror=function(e){return function(){image_loads.onerror(e)}}(e)),image_loads.is_error(e)||(i[e]>=KM.getRandomInt(5,10)||1==t||KM.item_in_array(e,n))&&image_loads.is_loaded(e)&&o<10?(i[e]=0,o++,image_loads.reset(e),a.src=KM.get_jpeg(e),KM.item_in_array(e,n)&&KM.add_timeout_id(d,setTimeout((function(){_(e,t)}),1e3/l))):void 0!==i[e]?i[e]++:i[e]=1)}catch(e){console.log(e)}}return image_loads=(e={},{onload:function(t){e[t]=!0},onerror:function(t){e[t]=!1},is_loaded:function(t){return!0===e[t]},is_error:function(t){return!1===e[t]},reset:function(t){delete e[t]}}),{init:a,set_last_camera:function(e){t=e},camera_jpeg_clicked:c}}(),KM.display_live=KM.display_live_.init,KM.display_live.set_last_camera=KM.display_live_.set_last_camera,KM.display_live.camera_jpeg_clicked=KM.display_live_.camera_jpeg_clicked,KM.display_archive_=function(){var e={},t={},n={},i=0;function o(e,n,i){if(KM.session_id.current===n){KM.show_loading(document.getElementById("arch_player"));var a={jsonrpc:"2.0",method:"archive",id:Math.random(),params:{func:"feeds",date:e}};KM.json_request("/ajax/archive",a,(function(e){(t=e)!=={}&&(function(){var e=document.getElementById("camera_select"),n=(e.selectedIndex,parseInt(e.value));isNaN(n)&&(n=KM.config.display_feeds[KM.config.misc.display_select][0]);for(var i=e.options.length-1;i>-1;i--)e.remove(i);document.getElementById("date_select").value;var o="";for(var a in t){(o=document.createElement("option")).text=KM.pad_out2(a)+": "+t[a].title,o.value=a;try{e.add(o,null)}catch(t){e.add(o)}}isNaN(n)?e.selectedIndex=0:e.value=n,d()}(),document.getElementById("date_select").disabled=!1,document.getElementById("camera_select").disabled=!1,document.getElementById("view_select").disabled=!1,KM.hide_loading(document.getElementById("arch_player"))),"function"==typeof i&&i()}),onerror=function(){KM.kill_timeout_ids(KM.ARCH_LOOP),KM.add_timeout_id(KM.ARCH_LOOP,setTimeout((function(){o(e,n)}),5e3))})}}function a(t,n){if(KM.session_id.current===t){KM.show_loading(document.getElementById("arch_player"));var i={jsonrpc:"2.0",method:"archive",id:Math.random(),params:{func:"dates"}};KM.json_request("/ajax/archive",i,(function(t){(e=t)!=={}&&function(){for(var t=document.getElementById("date_select"),n=t.options.length-1;n>-1;n--)t.remove(n);var i="",o="";for(n=0;n<e.length;n++){o=e[n],(i=document.createElement("option")).text=o.slice(0,4)+" / "+o.slice(4,6)+" / "+o.slice(6),i.value=o;try{t.add(i,null)}catch(e){t.add(i)}}document.getElementById("date_select").selectedIndex=0,c(),KM.hide_loading(document.getElementById("arch_player"))}(),"function"==typeof n&&n()}),onerror=function(){KM.kill_timeout_ids(KM.ARCH_LOOP),KM.add_timeout_id(KM.ARCH_LOOP,setTimeout((function(){a(t)}),5e3))})}}function l(e,t,i,o){if(KM.session_id.current===i){KM.show_loading(document.getElementById("arch_player"));var a={jsonrpc:"2.0",method:"archive",id:Math.random(),params:{date:e,feed:t,func:"movies"}};KM.json_request("/ajax/archive",a,(function(e){n=e,function(){for(var e=document.getElementById("view_select"),t=(e.selectedIndex,e.value),i=e.options.length-1;i>-1;i--)e.remove(i);var o=[];for(n.movies&&o.push({value:"movies",text:"Movies"}),n.snaps&&o.push({value:"snaps",text:"Snapshots"}),i=0;i<o.length;i++){var a=document.createElement("option");a.text=o[i].text,a.value=o[i].value;try{e.add(a,null)}catch(t){e.add(a)}}if(t)switch(t){case"movies":n.movies&&(e.value=t);break;case"snaps":n.snaps&&(e.value=t);break;default:e.selectedIndex=0}else e.selectedIndex=0;s(),KM.hide_loading(document.getElementById("arch_player"))}(),"function"==typeof o&&o()}),onerror=function(){KM.kill_timeout_ids(KM.ARCH_LOOP),KM.add_timeout_id(KM.ARCH_LOOP,setTimeout((function(){l(e,t,i,o)}),5e3))})}}function c(){f();var e=KM.session_id.current;i=0;document.getElementById("view_select").value;o(document.getElementById("date_select").value,e)}function d(){f();var e=KM.session_id.current,t=document.getElementById("view_select").value;l(document.getElementById("date_select").value,document.getElementById("camera_select").value,e,callback=function(){r(u(i,t))})}function s(){var e=document.getElementById("view_select").value,t=document.getElementById("html5player"),o=document.getElementById("player_obj");"movies"==e?t||f():"snaps"==e?t?f():o||f():f(),function(){var e,t,i="",o="",a=0,l=document.getElementById("view_select").value;if(document.getElementById("date_select").value,document.getElementById("camera_select").value,"movies"==l)for(var c=function(){for(var e,t,i=[],o=0;o<n.movies.length;o++)e=n.movies[o].start,t=n.movies[o].end,i[o]=t-e;i=i.sort((function(e,t){return e-t}));var a=Math.max(1,parseInt(i.length/10,10));return i.splice(i.length-a,a)}(),d=0;d<n.movies.length;d++)e=n.movies[d].start,o='onclick="KM.arch_event_clicked('+d+')"',a=(t=n.movies[d].end)-e,KM.item_in_array(a,c)&&(o+=' style="color:#D90000"'),i+="<span "+o+">",i+=KM.secs_hh_mm_ss(e),i+="&nbsp;&nbsp;-&nbsp;&nbsp;",i+=KM.secs_hh_mm_ss(t),i+="<br>",i+="</span>";else if("snaps"==l)for(d=0;d<n.snaps.length;d++)e=n.snaps[d].start,i+='<span onclick="KM.arch_event_clicked('+d+')">',i+=KM.secs_hh_mm_ss(e),i+="<br>",i+="</span>";else i="";document.getElementById("arch_playlist").innerHTML=i}(),r(u(i,e))}function r(e){var t=document.getElementById("view_select").value;KM.hide_loading(document.getElementById("arch_player")),KM.videoPlayer.set_next_movie(e+1);var o=document.getElementById("arch_playlist");if(null===o)return!1;for(var a=o.children,l=0;l<a.length;l++)l!=e?a[l].classList.remove("playlist_hlight"):(a[l].classList.add("playlist_hlight"),a[l].scrollIntoView(!1));i=n[t][e].start,_(n[t][e].start)}function _(e){var n=document.getElementById("camera_select").value,i=n;t&&n&&(i=t[n].title);var o=KM.secs_hh_mm_ss(e+KM.videoPlayer.get_time()),a=document.getElementById("playback_rate").value;document.getElementById("playback_info").innerHTML=i+" <"+o+"> ["+a+"]",n=null,i=null}function m(e,t){KM.kill_timeout_ids(KM.ARCH_LOOP),KM.session_id.current===t&&(document.getElementById("html5player")||f(),n.movies[e]?(r(e),i=n.movies[e].start,function(e){document.getElementById("date_select").value,document.getElementById("camera_select").value;var t=n.movies[e].file,i=(t.substr(t.lastIndexOf(".")),n.movies[e].start),o=(n.movies[e].end,parseInt(e)+1),a=document.getElementById("html5player"),l=n.snaps[u(i,"snaps")].file;a||(document.getElementById("arch_player").innerHTML='<div id="player_obj"></div>');if(KM.videoPlayer.set_cur_event_secs(i),KM.videoPlayer.set_next_movie(o),a)a.src=t,a.poster=l;else{var c=document.getElementById("playback_rate").value;KM.videoPlayer.set_video_player({id:"player_obj",src:t,width:"100%",height:"100%",config:{autoplay:!0,controls:!0,muted:!0,playbackRate:c,poster:l}}),(a=document.getElementById("html5player"))&&(a.onloadeddata=KM.videoPlayer.html5VideoLoaded,a.onseeked=KM.videoPlayer.html5VideoScrolled,a.ontimeupdate=KM.videoPlayer.html5VideoProgress,a.onended=KM.videoPlayer.html5VideoFinished,a=null)}}(e)):l(document.getElementById("date_select").value,document.getElementById("camera_select").value,t,callback=function(){KM.show_loading(document.getElementById("arch_player")),KM.kill_timeout_ids(KM.ARCH_LOOP),KM.add_timeout_id(KM.ARCH_LOOP,setTimeout((function(){m(e,t)}),1e4))}))}function u(e,t){var i=0;if(n[t])for(i=0;i<n[t].length-1;i++){if(n[t][i].start===e)return i;if(n[t][i].start>e){if(e<=n[t][i].end)return i;if(i>0)return i-1}}return i}function f(){KM.session_id.current++,KM.kill_timeout_ids(KM.ARCH_LOOP),document.getElementById("arch_player").innerHTML=""}return snap_player=function(){var e,t,o=1,a=new Image,c=-1,d=1,s=1e3,m=0;function u(){KM.session_id.current===e&&(n.snaps[c]?KM.add_timeout_id(KM.ARCH_LOOP,setTimeout((function(){f()}),s-Math.min(100,(new Date).getTime()-m))):l(document.getElementById("date_select").value,document.getElementById("camera_select").value,e,callback=function(){KM.kill_timeout_ids(KM.ARCH_LOOP),KM.add_timeout_id(KM.ARCH_LOOP,setTimeout((function(){u()}),1e4))}))}function f(){n.snaps[c+d]?(c+=d,KM.kill_timeout_ids(KM.ARCH_LOOP),r(c),a.src=n.snaps[c].file,m=(new Date).getTime(),_(i=n.snaps[c].start),p()):g()}function g(){KM.session_id.current++}function p(){var e=document.getElementById("playback_rate");null!==e&&(o=Math.abs(e.value)),s=1e3/o}function h(){KM.kill_timeout_ids(KM.ARCH_LOOP),KM.session_id.current===e?g():(e=KM.session_id.current,f())}return{set_player:function(e){KM.session_id.current++,t=document.getElementById(e.id),a.style.width=e.width,a.style.height=e.height,document.onkeydown=function(e){switch(e.which){case 39:d=1,f();break;case 37:d=-1,f();break;case 32:h();break;default:return!0}return!1},a.onload=function(){u()},a.onerror=function(){u()},a.onclick=h,t.appendChild(a),c=e.snap_id,h()},playpause:h,play:f,stop:g,progress:p}}(),{init:function(){KM.session_id.current++;var e=KM.session_id.current;KM.hide_loading(document.getElementById("main_display")),document.getElementById("main_display").innerHTML='        <div class="title">kmotion: Archive-><span id="playback_info"></span></div>        <div id="arch_display">            <div id="config_bar">                <select id="date_select" onchange="KM.arch_change_date();" > </select>                 <select id="camera_select" onchange="KM.arch_change_camera();" > </select>                 <select id="view_select" onchange="KM.arch_change_view();" > </select>             </div>            <div id="arch_display_html">                <div id="arch_playlist"></div>                <div id="arch_player"></div>                <form id="playback_form">                    <input id="playback_rate" type="range" value="1" min="0.1" max="10" step="0.1" list="tickmarks">                        <datalist id="tickmarks">                            <option value="0" label="0">                            <option value="1" label="1">                            <option value="2" label="2">                            <option value="3" label="3">                            <option value="4" label="4">                            <option value="5" label="5">                            <option value="6" label="6">                            <option value="7" label="7">                            <option value="8" label="8">                            <option value="9" label="9">                            <option value="10" label="10">                        </datalist>                </form>            </div>        </div>',window.onresize=null,a(e)},change_date:c,change_camera:d,change_view:s,event_clicked:function(e){var t,n=document.getElementById("view_select").value;"movies"==n?m(e,KM.session_id.current):"snaps"==n&&(t=e,f(),document.getElementById("arch_player").innerHTML='<div id="player_obj"> </div>',snap_player.set_player({id:"player_obj",width:"100%",height:"100%",snap_id:t}))},update_playback_info:_}}(),KM.display_archive=KM.display_archive_.init,KM.arch_change_date=KM.display_archive_.change_date,KM.arch_change_camera=KM.display_archive_.change_camera,KM.arch_change_view=KM.display_archive_.change_view,KM.arch_event_clicked=KM.display_archive_.event_clicked,KM.update_playback_info=KM.display_archive_.update_playback_info,KM.display_logs_=function(){var e,t,n;function i(e){var t=e.split("#");return 3===t.length?"Date : "+t[0]+"&nbsp;&nbsp;Time : "+t[1]+"&nbsp;&nbsp;Event : "+t[2]+"<br>":e+"<br>"}function o(t){e=t,function(){for(var t="",o=e.length-1;o>=0;o--)o==e.length-1&&-1!==e[o].search(new RegExp("shutting","i"))||-1!==e[o].search(new RegExp("fatal|critical|failed|error|emg|err|alr|crt","i"))?t+='<span style="color:'+KM.RED+';">'+i(e[o])+"</span>":-1!==e[o].search(new RegExp("warning|wrn","i"))?t+='<span style="color:'+KM.YELLOW+';">'+i(e[o])+"</span>":-1!==e[o].search(new RegExp("debug|dbg","i"))?t+='<span style="color:'+KM.DARK_GREY+';">'+i(e[o])+"</span>":t+=i(e[o]);n.innerHTML=t,KM.hide_loading(n)}()}function a(){if(t===KM.session_id.current){n.innerHTML="",KM.show_loading(n),document.getElementsByClassName("title")[0].innerHTML="kmotion: Logs->Kmotion logs",e=null;var i={jsonrpc:"2.0",method:"logs",id:Math.random()};KM.json_request("/ajax/logs",i,o,onerror=function(){KM.kill_timeout_ids(KM.LOGS),t===KM.session_id.current&&KM.add_timeout_id(KM.LOGS,setTimeout((function(){a()}),5e3))})}}return{init:function(){KM.session_id.current++,t=KM.session_id.current,KM.hide_loading(document.getElementById("main_display")),document.getElementById("main_display").innerHTML='        <div class="title">kmotion: Logs</div>        <div class="divider" >           <img src="images/config_divider_color.png" alt="" style="width:100%;">        </div>            <div class="config_backdrop">            <div id="config_bar">               <input type="button" value="Kmotion logs" onclick="KM.get_kmotion_logs()" />               <input type="button" value="Motion logs" id="feed_button" onclick="KM.get_motion_logs()" />            </div>            <div id="config_html"></div>        </div>',n=document.getElementById("config_html"),window.onresize=null,a()},get_kmotion_logs:a,get_motion_logs:function(){if(t===KM.session_id.current){n.innerHTML="",KM.show_loading(n),document.getElementsByClassName("title")[0].innerHTML="kmotion: Logs->Motion logs",e=null;var i={jsonrpc:"2.0",method:"outs",id:Math.random()};KM.json_request("/ajax/outs",i,o,onerror=function(){KM.kill_timeout_ids(KM.LOGS),t===KM.session_id.current&&KM.add_timeout_id(KM.LOGS,setTimeout((function(){get_kmotion_outs()}),5e3))})}}}}(),KM.display_logs=KM.display_logs_.init,KM.get_kmotion_logs=KM.display_logs_.get_kmotion_logs,KM.get_motion_logs=KM.display_logs_.get_motion_logs,KM.display_config_=function(){var e=1,t="";function n(){KM.session_id.current++,e=KM.config.display_feeds[KM.config.misc.display_select][0],document.getElementById("main_display").innerHTML='        <div class="title">kmotion: Config</div>        <div class="divider">           <img src="images/config_divider_color.png" alt="" style="width:100%;">        </div>        <div class="config_backdrop">            <div id="config_bar">               <input type="button" value="Misc" id="misc_button" onclick="KM.conf_misc_html()" />               <input type="button" value="Cameras" id="feed_button" onclick="KM.conf_feed_html()" />               <input type="button" value="Server Load" onclick="KM.conf_select_load();" />            </div>            <div id="config_html"></div>        </div>',i()}function i(){for(var e in document.getElementById("config_html").innerHTML='<br />                <div class="config_group_margin">                    <div class="config_tick_margin">                      <input type="checkbox" id="logs_enabled" onchange="KM.conf_misc_highlight(this);" /><label for="logs_enabled">Logs enabled.</label><br>                      <input type="checkbox" id="archive_enabled" onchange="KM.conf_misc_highlight(this);" /><label for="archive_enabled">Archive enabled.</label><br>                    </div>                    <div class="config_tick_margin">                        <input type="checkbox" id="config_enabled" onchange="KM.conf_misc_highlight(this);" /><label for="config_enabled">Config enabled.</label><br>                        <input type="checkbox" id="hide_button_bar" onchange="KM.conf_misc_highlight(this);" /><label for="hide_button_bar">Hide button bar.</label><br>                    </div>                </div>                <br /><hr/>                <div class="config_group_margin">                    <div class="theme_dark"><input type="radio" name="color_select" value="0" onchange="KM.conf_color_select(this);">Dark theme</div>                    <div class="theme_white"><input type="radio" name="color_select" value="1" onchange="KM.conf_color_select(this);">Light theme</div>                </div>                <br /><hr/>                <div class="config_group_margin">                <input type="checkbox" id="save_display" onchange="KM.conf_misc_highlight(this);" /><label for="save_display">Save the current "Display Select" configuration as default.</label><br>                </div>                <div class="config_group_margin">                <input type="checkbox" id="force_reload" onchange="KM.conf_misc_highlight(this);" /><label for="force_reload">Force reload kmotion.</label><br>                </div>                <br /><hr/>                <div class="config_text_margin" id="conf_text" >                  <input type="button" id="conf_apply" onclick="KM.conf_apply();" value="Apply" />&nbsp;all changes to the local browser configuration and sync with the remote server.               </div>',(document.getElementById("feed_button").style.color||document.getElementById("misc_button").style.color)&&(document.getElementById("conf_apply").style.color=KM.BLUE,document.getElementById("conf_apply").style.fontWeight="bold"),KM.config.misc)try{"boolean"==typeof KM.config.misc[e]?document.getElementById(e).checked=KM.config.misc[e]:document.getElementById(e).value=KM.config.misc[e]}catch(e){}for(var e in KM.config)try{"boolean"==typeof KM.config[e]?document.getElementById(e).checked=KM.config[e]:document.getElementById(e).value=KM.config[e]}catch(e){}document.getElementsByName("color_select")[KM.config.misc.color_select].checked=!0,document.getElementsByClassName("title")[0].innerHTML="kmotion: Config->Misc"}function o(e){document.getElementById("misc_button").style.fontWeight="bold",document.getElementById("misc_button").style.color=KM.BLUE,document.getElementById("conf_apply").style.fontWeight="bold",document.getElementById("conf_apply").style.color=KM.BLUE,function(e){switch(e.id){case"save_display":case"force_reload":KM.config[e.id]=e.checked;break;default:"checkbox"==e.type?KM.config.misc[e.id]=e.checked:KM.config.misc[e.id]=e.value}}(e)}function a(){KM.kill_timeout_ids(KM.MISC_JUMP);for(var n="",i=1;i<226;i++)n+='<div id="mask_'+i+'" style="position:absolute; left:10px; top:10px;"><img id="mask_img_'+i+'" style="width:23px; height:17px;"onclick="KM.conf_toggle_feed_mask('+i+');" src="images/mask_trans.png" alt=""></div>';for(var o in n+='<br>        <div style="float:left; width:370px;">            <div class="config_margin_left_20px">                <img id="feedimage" src="images/gcam.png" alt="">                <div class="config_form">                    <input type="button" id="mask_all" style="width:100%;" OnClick="KM.conf_feed_mask_button(1);" value="Mask All" disabled>                    <input type="button" id="mask_invert" style="width:100%;" OnClick="KM.conf_feed_mask_button(2);" value="Mask Invert" disabled>                    <input type="button" id="mask_none" style="width:100%;" OnClick="KM.conf_feed_mask_button(3);" value="Mask None" disabled>                </div>            </div>            <div class="config_margin_left_20px" style="font-weight:bold;padding:10px;text-align:center">            <label for="feed_smart_mask_speed">Smart mask speed:</label>            <input type="range" id="feed_smart_mask_speed" style="width:100%;" onchange="KM.conf_feed_highlight(this);" min="0" max="10" value="0" list="tickmarks" disabled>            <datalist id="tickmarks">                <option value="0" label="0">                <option value="1" label="1">                <option value="2" label="2">                <option value="3" label="3">                <option value="4" label="4">                <option value="5" label="5">                <option value="6" label="6">                <option value="7" label="7">                <option value="8" label="8">                <option value="9" label="9">                <option value="10" label="10">            </datalist>            </div>        </div>',n+='<div  class="config_form">            <label for="feed_camera">Select camera:</label>            <select  id="feed_camera" onchange="KM.conf_feed_change();">',KM.config.feeds)KM.config.feeds[o].feed_name||(KM.config.feeds[o].feed_name=""),n+='<option value="'+o+'">'+o+": "+KM.config.feeds[o].feed_name+"</option>";for(var o in n+='</select>            </div>                <hr/>                   <div class="config_form"><label for="feed_name">Camera title:</label>                    <input type="text" id="feed_name" onchange="KM.conf_feed_highlight(this);" />                  </div>                  <div class="config_form"><label for="feed_enabled">Enable camera:</label>                    <input type="checkbox" id="feed_enabled" onchange="KM.conf_feed_enabled(this);" />                  </div>                  <div class="config_form"><label for="reboot_camera">Reboot camera:</label>                    <input type="checkbox" id="reboot_camera" onchange="KM.conf_feed_highlight(this);" />                  </div>                  <hr/>                   <div class="config_form"><label for="feed_device">Device:</label>                    <select  id="feed_device" onchange="KM.conf_feed_net_highlight(this);" disabled>',KM.config.feeds)n+='<option value="'+o+'">/dev/video'+o+"</option>";n+='<option value="-1">Network Camera</option>                        </select>                  </div>                  <div class="config_form"><label for="feed_input">Input:</label>                    <select id="feed_input" onchange="KM.conf_feed_highlight(this);" disabled>                        <option selected value="-1">USB</option>                        <option value="0">0</option>                        <option value="1">1</option>                        <option value="2">2</option>                        <option value="3">3</option>                        <option value="4">4</option>                        <option value="5">5</option>                        <option value="6">6</option>                        <option value="7">7</option>                    </select>                  </div>                  <hr/>                  <div class="config_form"><label for="feed_lgn_name">Name:</label>                    <input type="text" id="feed_lgn_name" onchange="KM.conf_feed_highlight(this);" />                  </div>                  <div class="config_form"><label for="feed_lgn_pw">Password:</label>                    <input type="password" id="feed_lgn_pw" onchange="KM.conf_feed_highlight(this);" />                  </div>                  <hr/>                  <div class="config_form"><label for="feed_proxy">Proxy:</label>                    <input type="text" id="feed_proxy" onchange="KM.conf_feed_highlight(this);" />                  </div>                  <div class="config_form"><label for="feed_url">MJPEG URL:</label>                    <input type="url" id="feed_url" onchange="KM.conf_feed_highlight(this);" />                  </div>                  <hr/>                  <div class="config_form"><label for="rtsp2mp4_url">RTSP URL:</label>                    <input type="url" id="rtsp2mp4_url" onchange="KM.conf_feed_highlight(this);" />                  </div>                  <div class="config_form"><label for="rtsp2mp4_recode">RTSP Recode:</label>                    <input type="checkbox" id="rtsp2mp4_recode" onchange="KM.conf_feed_highlight(this);" />                  </div>                  <div class="config_form"><label for="rtsp2mp4_sound">RTSP Sound:</label>                    <input type="checkbox" id="rtsp2mp4_sound" onchange="KM.conf_feed_highlight(this);" />                  </div>                  <hr/>                  <div class="config_form"><label for="feed_width">Width (must be a multiple of 8):</label>                    <input type="number" id="feed_width" size="4" onchange="KM.conf_feed_highlight(this);" min="1"/>                  </div>                  <div class="config_form"><label for="feed_height">Height (must be a multiple of 8):</label>                    <input type="number" id="feed_height" size="4" onchange="KM.conf_feed_highlight(this);" min="1"/>                  </div>                  <div class="config_form"><label for="feed_webpicture_scale">Web Scale:</label>                    <input type="number" id="feed_webpicture_scale" onchange="KM.conf_feed_highlight(this);" value="1" step="0.1" min="0.1"/>                  </div>                  <hr/>                  <div class="config_form"><label for="feed_fps">FPS:</label>                    <input type="number" id="feed_fps" onchange="KM.conf_feed_highlight(this);" value="1" min="1"/>                  </div>                  <div class="config_form"><label for="feed_kbs">Bitrate:</label>                    <input type="number" id="feed_kbs" onchange="KM.conf_feed_highlight(this);" value="1024" min="1"/>                  </div>                  <hr/>                  <div class="config_form"><label for="feed_threshold">Threshold:</label>                    <input type="number" id="feed_threshold" size="4" onchange="KM.conf_feed_highlight(this);" value="300" min="1"/>                  </div>                  <div class="config_form"><label for="feed_noise_level">Noise level:</label>                    <input type="number" id="feed_noise_level" size="4" onchange="KM.conf_feed_highlight(this);" value="32" />                  </div>                  <div class="config_form"><label for="feed_noise_tune">Noise tune:</label>                    <input type="checkbox" id="feed_noise_tune" onchange="KM.conf_feed_highlight(this);" />                  </div>                  <div class="config_form"><label for="ext_motion_detector">External motion detector:</label>                    <input type="checkbox" id="ext_motion_detector" onchange="KM.conf_feed_highlight(this);" />                  </div>                  <hr/>                  <div class="config_form"><label for="feed_show_box">Enable motion highlighting:</label>                    <input type="checkbox" id="feed_show_box" onclick="KM.conf_feed_highlight(this);" />                  </div>                  <hr/>                  <div class="config_form"><label for="feed_snap_interval">Snapshot interval:</label>                    <input type="number" id="feed_snap_interval" size="4" onchange="KM.conf_feed_highlight(this);" value="300" min="0"/>                  </div>                  <div class="config_form"><label for="feed_quality">Quality of snapshots:</label>                    <input type="number" id="feed_quality" size="3" onchange="KM.conf_feed_highlight(this);" value="85" min="1"/>                  </div>',KM.config.feeds[e].feed_enabled&&(n=(n=n.replace(/disabled/g,"")).replace(/gcam.png/,"bcam.png")),document.getElementById("config_html").innerHTML=n;var a=document.getElementById("feedimage");a.width=345,a.height=255,KM.config.feeds[e].feed_enabled&&(s(KM.session_id.current,e),c()),document.getElementById("feed_camera").value=e;try{document.getElementById("reboot_camera").checked=1==KM.config.feeds[e].reboot_camera}catch(e){}for(var d in KM.config.feeds[e])try{"boolean"==typeof KM.config.feeds[e][d]?document.getElementById(d).checked=KM.config.feeds[e][d]:document.getElementById(d).value=KM.config.feeds[e][d]}catch(e){}var r=a.offsetTop,_=a.offsetLeft,m=0;KM.browser.browser_OP&&(m=-2),KM.browser.browser_IE&&(m=-2),_+=m,r+=m;for(var u=0,f=0;f<15;f++)for(var g=0;g<15;g++)u=g+1+15*f,document.getElementById("mask_"+u).style.top=r+17*f+"px",document.getElementById("mask_"+u).style.left=_+23*g+"px";if(KM.config.feeds[e].feed_mask){t="";var p=KM.config.feeds[e].feed_mask.split("#");for(i=0;i<15;i++)t+=KM.pad_out(parseInt(p[i],16).toString(2),15);if(KM.config.feeds[e].feed_enabled)for(i=0;i<225;i++)"1"===t.charAt(i)&&(document.getElementById("mask_img_"+(i+1)).src="images/mask.png")}document.getElementsByClassName("title")[0].innerHTML="kmotion: Config->Cameras",l()}function l(){document.getElementById("feed_enabled").checked?function(){s(KM.session_id.current,e);for(var n=document.getElementsByClassName("config_form"),i=0;i<n.length;i++){elem=n[i];for(var o=0;o<elem.children.length;o++)elem.children[o].disabled=!1}c(),document.getElementById("feedimage").src="images/bcam.png";for(i=0;i<225;i++)"1"===t.charAt(i)&&(document.getElementById("mask_img_"+(i+1)).src="images/mask.png")}():function(){KM.session_id.current++;for(var e=document.getElementsByClassName("config_form"),t=0;t<e.length;t++){elem=e[t];for(var n=0;n<elem.children.length;n++){var i=elem.children[n];i.id&&!KM.item_in_array(i.id,["feed_enabled","feed_camera"])&&(i.disabled=!0)}}for(t=1;t<226;t++)try{document.getElementById("mask_img_"+t).src="images/mask_trans.png"}catch(e){}try{document.getElementById("feedimage").src="images/gcam.png"}catch(e){}}()}function c(){-1==document.getElementById("feed_device").value?(document.getElementById("feed_input").disabled=!0,document.getElementById("feed_url").disabled=!1,document.getElementById("feed_proxy").disabled=!1,document.getElementById("feed_lgn_name").disabled=!1,document.getElementById("feed_lgn_pw").disabled=!1):(document.getElementById("feed_input").disabled=!1,document.getElementById("feed_url").disabled=!0,document.getElementById("feed_proxy").disabled=!0,document.getElementById("feed_lgn_name").disabled=!0,document.getElementById("feed_lgn_pw").disabled=!0)}function d(n){return document.getElementById("feed_button").style.fontWeight="bold",document.getElementById("feed_button").style.color=KM.BLUE,function(n){switch(n.id){case"feed_width":case"feed_height":var i=parseInt(n.value,10);isNaN(i)&&(i=0),KM.config.feeds[e][n.id]=i;break;case"feed_mask":i="";KM.config.feeds[e][n.id]="";for(var o=0;o<15;o++)i=t.substr(15*o,15),KM.config.feeds[e][n.id]+=parseInt(i,2).toString(16)+"#";break;default:"checkbox"==n.type?KM.config.feeds[e][n.id]=n.checked:KM.config.feeds[e][n.id]=n.value}}(n),!1}function s(e,t){!function e(t,n){if(KM.kill_timeout_ids(KM.CONFIG_LOOP),KM.session_id.current===t)try{var i=document.getElementById("feedimage");i.onerror=function(){this.src="images/gcam.png"},i.src=KM.get_jpeg(n),KM.add_timeout_id(KM.CONFIG_LOOP,setTimeout((function(){e(t,n)}),1e3))}catch(e){}}(e,t)}function r(){var e=KM.session_id.current,t="#00FF00",n="#FF0000",i=document.getElementById("config_html"),o=(i.clientWidth,{});function a(e,t){return KM.browser.browser_IE?'<div class="bar_bground" style="margin-top:9px;"><div id="bar_fground'+t+'" class="bar_fground" style="background-color:'+'#00FF00;"></div><span id="bar_text'+t+'" class="bar_text_IE">'+e+'</span><span id="bar_value'+t+'" class="bar_text_IE"></span></div>':'<div class="bar_bground" style="margin-top:9px;"><span id="bar_text'+t+'" class="bar_text">'+e+'</span><span id="bar_value'+t+'" class="bar_value"></span><div id="bar_fground'+t+'" class="bar_fground" style="background-color:'+'#00FF00;"></div></div>'}i.innerHTML='<br><div id="server_info" class="config_text_center">Please wait - Downloading server data.</div><br /><div id="load_av_title" class="config_text_center">Load Averages</div>'+a("1 min",1)+a("5 min",2)+a("15 min",3)+'<br /><div id="cpu_title" class="config_text_center">Central Processing Unit</div>'+a("User",4)+a("System",5)+a("IO Wait",6)+'<br /><div id="memory_title" class="config_text_center">Memory</div>'+a("System",7)+a("Buffered",8)+a("Cached",9)+a("Swap",10)+'<br /><div id="fs_title" class="config_text_center">File systems</div>'+a("Archive",11)+a("Ramdisk",12)+"<br />",function i(){if(KM.session_id.current===e){var a={jsonrpc:"2.0",method:"loads",id:Math.random()};KM.json_request("/ajax/loads",a,(function(e){o=e,document.getElementById("server_info").innerHTML=o.uname+" Uptime "+o.up,document.getElementById("memory_title").innerHTML="Memory "+o.memstat.mt+"k",document.getElementById("bar_text11").innerHTML=o.fsarch[3],document.getElementById("bar_text12").innerHTML=o.fsramdisk[3],function(){var e=o.cpu+.5;document.getElementById("bar_value1").innerHTML=o.loadavg[0];var i=Math.min(o.loadavg[0],e);document.getElementById("bar_fground1").style.width=i/e*100+"%",document.getElementById("bar_value2").innerHTML=o.loadavg[1],i=Math.min(o.loadavg[1],e),document.getElementById("bar_fground2").style.width=i/e*100+"%",i>=o.cpu?document.getElementById("bar_fground2").style.backgroundColor=n:document.getElementById("bar_fground2").style.backgroundColor=t,document.getElementById("bar_value3").innerHTML=o.loadavg[2],i=Math.min(o.loadavg[2],e),document.getElementById("bar_fground3").style.width=i/e*100+"%",i>=o.cpu?document.getElementById("bar_fground3").style.backgroundColor=n:document.getElementById("bar_fground3").style.backgroundColor=t,document.getElementById("bar_value4").innerHTML=o.cpuusage.cu+"%",i=o.cpuusage.cu,document.getElementById("bar_fground4").style.width=i+"%",document.getElementById("bar_value5").innerHTML=o.cpuusage.cs+"%",i=o.cpuusage.cs,document.getElementById("bar_fground5").style.width=i+"%",document.getElementById("bar_value6").innerHTML=o.cpuusage.ci+"%",i=o.cpuusage.ci,document.getElementById("bar_fground6").style.width=i+"%";var a=parseInt(o.memstat.mf)+parseInt(o.memstat.mb)+parseInt(o.memstat.mc),l=o.memstat.mt-a;document.getElementById("bar_value7").innerHTML=l+"k",i=l/o.memstat.mt*100,document.getElementById("bar_fground7").style.width=i+"%",document.getElementById("bar_value8").innerHTML=o.memstat.mb+"k",i=o.memstat.mb/o.memstat.mt*100,document.getElementById("bar_fground8").style.width=i+"%",document.getElementById("bar_value9").innerHTML=o.memstat.mc+"k",i=o.memstat.mc/o.memstat.mt*100,document.getElementById("bar_fground9").style.width=i+"%",document.getElementById("bar_value10").innerHTML=o.memstat.su+"k",o.memstat.st=Math.max(o.memstat.st,1),i=o.memstat.su/o.memstat.st*100,document.getElementById("bar_fground10").style.width=i+"%",document.getElementById("bar_fground10").style.backgroundColor=i>=.1?n:t,document.getElementById("bar_value11").innerHTML=o.fsarch[0],i=o.fsarch[2].substring(0,o.fsarch[2].length-1),document.getElementById("bar_fground11").style.width=o.fsarch[2],document.getElementById("bar_fground11").style.backgroundColor=i>=95?n:t,document.getElementById("bar_value12").innerHTML=o.fsramdisk[0],i=o.fsramdisk[2].substring(0,o.fsramdisk[2].length-1),document.getElementById("bar_fground12").style.width=o.fsramdisk[2],document.getElementById("bar_fground12").style.backgroundColor=i>=50?n:t}(),KM.kill_timeout_ids(KM.CONFIG_LOOP),o=null,KM.add_timeout_id(KM.CONFIG_LOOP,setTimeout((function(){i()}),2e3))}))}}()}return conf_config_track=function(){var e={};function t(){e=JSON.parse(JSON.stringify(KM.config))}function n(){for(var e in KM.config.save_display=!1,KM.config.force_reload=!1,KM.config.feeds)delete KM.config.feeds[e].reboot_camera;t()}return{init:t,sync:function(t){KM.config.save_display&&(delete e.display_feeds,delete e.misc.display_select),diffObjects=function(e,t){if(null===e||"object"!=typeof e)return e!==t?e:null;if(t){var n=e.constructor();for(var i in e){var o=diffObjects(e[i],t[i]);null!==o&&(n[i]=o)}}else n=JSON.parse(JSON.stringify(e));return n};var i=diffObjects(KM.config,e),o=JSON.stringify(i),a={jsonrpc:"2.0",method:"config",id:Math.random(),params:{write:1,jdata:o}};KM.json_request("/ajax/config",a,n)}}}(),{init:function(){KM.session_id.current++,conf_config_track.init(),n()},conf_select_load:function(){KM.session_id.current++,r(),document.getElementsByClassName("title")[0].innerHTML="kmotion: Config->Server load"},conf_misc_html:i,conf_misc_highlight:o,conf_color_select:function(e){KM.background_button_clicked(parseInt(e.value)),o(e)},conf_feed_html:a,conf_apply:function(){conf_config_track.sync(),KM.blink_button(document.getElementById("conf_apply"),n)},conf_feed_change:function(){KM.session_id.current++,e=document.getElementById("feed_camera").value,KM.add_timeout_id(KM.MISC_JUMP,setTimeout((function(){a()}),1))},conf_feed_enabled:function(e){d(e),l(),KM.menu_bar_buttons.construct_camera_sec()},conf_feed_highlight:d,conf_feed_net_highlight:function(e){c(),d(e)},conf_toggle_feed_mask:function(e){"0"===t.charAt(e-1)&&document.getElementById("feed_enabled").checked?(document.getElementById("mask_img_"+e).src="images/mask.png",t=t.substr(0,e-1)+"1"+t.substr(e)):(document.getElementById("mask_img_"+e).src="images/mask_trans.png",t=t.substr(0,e-1)+"0"+t.substr(e)),d({id:"feed_mask"}),document.getElementById("feed_smart_mask_speed").value=0},conf_feed_mask_button:function(e){for(var n=1;n<226;n++)1===e?(document.getElementById("mask_img_"+n).src="images/mask.png",t=t.substr(0,n-1)+"1"+t.substr(n)):2===e?"0"===t.substr(n-1,1)?(t=t.substr(0,n-1)+"1"+t.substr(n),document.getElementById("mask_img_"+n).src="images/mask.png"):(t=t.substr(0,n-1)+"0"+t.substr(n),document.getElementById("mask_img_"+n).src="images/mask_trans.png"):3===e&&(document.getElementById("mask_img_"+n).src="images/mask_trans.png",t=t.substr(0,n-1)+"0"+t.substr(n));d({id:"feed_mask"}),document.getElementById("feed_smart_mask_speed").value=0}}}(),KM.display_config=KM.display_config_.init,KM.conf_error_html=KM.display_config_.conf_error_html,KM.conf_select_errors=KM.display_config_.conf_select_errors,KM.conf_select_load=KM.display_config_.conf_select_load,KM.conf_misc_html=KM.display_config_.conf_misc_html,KM.conf_misc_highlight=KM.display_config_.conf_misc_highlight,KM.conf_color_select=KM.display_config_.conf_color_select,KM.conf_apply=KM.display_config_.conf_apply,KM.conf_feed_html=KM.display_config_.conf_feed_html,KM.conf_feed_change=KM.display_config_.conf_feed_change,KM.conf_feed_enabled=KM.display_config_.conf_feed_enabled,KM.conf_feed_highlight=KM.display_config_.conf_feed_highlight,KM.conf_feed_net_highlight=KM.display_config_.conf_feed_net_highlight,KM.conf_toggle_feed_mask=KM.display_config_.conf_toggle_feed_mask,KM.conf_feed_mask_button=KM.display_config_.conf_feed_mask_button,KM.videoPlayer=function(){var e=0,t=0,n=0;return{set_video_player:function(e){var t,n;if("html5"==function(e){switch(e){case"mp4":if((t=document.createElement("video")).canPlayType)return h264Test=t.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"'),"probably"==h264Test?"html5":"none";case"ogv":if((t=document.createElement("video")).canPlayType)return oggTest=t.canPlayType('video/ogg; codecs="theora, vorbis"'),oggTest&&"probably"==oggTest?"html5":"none";case"webm":var t;if((t=document.createElement("video")).canPlayType)return webmTest=t.canPlayType('video/webm; codecs="vp8.0, vorbis"'),webmTest&&"probably"==webmTest?"html5":"none";break;default:return"none"}}((t=e.src,null==(n=/^.+\.([^.]+)$/.exec(t))?"":n[1]))){document.getElementById(e.id).innerHTML='<video id="html5player" width="'+e.width+'" height="'+e.height+'"</video>';var i=document.getElementById("html5player");for(var o in e.config)if(e.config.hasOwnProperty(o))try{i[o]=e.config[o]}catch(e){}i.innerHTML='<p><a href="'+document.URL+e.src+"\" target='_blank'>DOWNLOAD: "+e.src.split(/(\\|\/)/g).pop()+"</a></p>",i.src=e.src,i.focus()}else document.getElementById(e.id).innerHTML='<p><a href="'+document.URL+e.src+"\" target='_blank'>DOWNLOAD: "+e.src.split(/(\\|\/)/g).pop()+"</a></p>"},set_cur_event_secs:function(e){n=e},set_next_movie:function(e){t=e},get_time:function(){return document.getElementById("html5player")||(e=0),e},html5VideoProgress:function(){if(document.getElementById("html5player")){var t=document.getElementById("html5player"),i=document.getElementById("playback_rate").value;t.playbackRate=i,e=t.currentTime,KM.update_playback_info(n),t=null}},html5VideoScrolled:function(){if(document.getElementById("html5player")){var t=document.getElementById("html5player");e=t.currentTime,KM.update_playback_info(n),t=null}},html5VideoFinished:function(){KM.arch_event_clicked(t)},html5playerPlayPause:function(){if(document.getElementById("html5player")){var e=document.getElementById("html5player");e.paused?e.play():e.pause(),e=null}},html5VideoLoaded:function(){document.onkeydown=function(t){if(document.getElementById("html5player")){var i=document.getElementById("html5player");switch(t.which){case 39:(e+=1)<=i.duration-1&&(i.currentTime=e);break;case 37:(e-=1)>=1&&(i.currentTime=e);break;default:return!0}KM.update_playback_info(n),i=null}return!1}}}}(),KM.init();
